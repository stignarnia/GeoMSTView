/* Core layout */
html,
body,
#map {
  height: 100%;
  margin: 0;
  padding: 0;
  background: var(--bg-map);
  font-family: var(--font-family, 'Fredoka', sans-serif);
}

/* Controls panel */
.controls {
  position: absolute;
  top: var(--controls-top);
  left: 50%;
  transform: translateX(-50%);
  z-index: var(--z-controls);
  background: var(--bg-panel);
  color: var(--text-light);
  padding: var(--controls-padding);
  border-radius: var(--controls-border-radius);
  width: min(var(--controls-width), calc(100% - var(--controls-side-margin)));
  max-width: calc(100% - var(--controls-side-margin));
  box-sizing: border-box;
  box-shadow: var(--shadow-controls);
  transition: padding var(--transition-expand),
    max-height var(--transition-expand);
  overflow: hidden;
  max-height: var(--controls-max-height);
}

.controls.collapsed {
  padding-top: var(--controls-padding-collapsed);
  padding-bottom: var(--controls-padding-collapsed);
  max-height: var(--controls-collapsed-height);
  transition: padding var(--transition-collapse),
    max-height var(--transition-collapse);
}

/* Buttons and rows */
.btnRow {
  display: flex;
  gap: var(--gap-medium);
  align-items: center;
  margin-top: var(--gap-small);
  flex-wrap: wrap;
}

.modalBtn {
  min-width: var(--btn-min-width);
  height: var(--btn-height);
  padding: var(--btn-padding);
  border-radius: var(--btn-border-radius);
  border: 1px solid var(--border-light);
  background: var(--bg-overlay-light);
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  font-weight: var(--font-weight-semibold);
  color: var(--text-light);
  transition: background var(--transition-button);
}

/* Generic hover/active for all modal buttons so icon-only inherits behaviour */
.modalBtn:hover {
  background: var(--btn-variant-hover, var(--bg-overlay-hover));
}
.modalBtn:active {
  background: var(--btn-variant-active, var(--bg-overlay-active));
}

/* Make inline SVG icons scale like text and match other icon sizes */
.modalBtn svg {
  width: 1em;
}

/* Icon-only buttons: keep same footprint as other buttons but centered */
.modalBtn.iconOnly {
  padding: 0;
}

.modalHeader strong {
  font-size: var(--font-size-modal-title);
  flex: 1;
  text-align: left;
  color: var(--text-white);
}

/* Button variants */
.btnOk {
  background: var(--btn-ok-bg);
  color: var(--text-white);
  border-color: var(--btn-ok-border);
  --btn-variant-hover: var(--btn-ok-hover);
  --btn-variant-active: var(--btn-ok-active);
}

.btnClose {
  background: var(--btn-close-bg);
  color: var(--text-white);
  border-color: var(--btn-close-border);
  --btn-variant-hover: var(--btn-close-hover);
  --btn-variant-active: var(--btn-close-active);
}

.btnRevert {
  background: var(--btn-revert-bg);
  color: var(--text-dark);
  border-color: var(--btn-revert-border);
  --btn-variant-hover: var(--btn-revert-hover);
  --btn-variant-active: var(--btn-revert-active);
}

/* Spinner */
.spinner {
  width: var(--spinner-size);
  height: var(--spinner-size);
  border: var(--spinner-border-width) solid var(--spinner-border);
  border-top-color: var(--spinner-top);
  border-radius: 50%;
  animation: spin 1s linear infinite;
  display: inline-block;
  vertical-align: middle;
  position: absolute;
  right: var(--spinner-right);
  bottom: var(--controls-top);
  z-index: calc(var(--z-collapse-btn) + 1);
  transition: opacity var(--transition-expand),
    transform var(--transition-expand);
  opacity: 0;
  transform: translateY(var(--anim-offset-y)) scale(var(--anim-scale));
}

.spinnerText {
  position: absolute;
  right: var(--spinner-text-right);
  bottom: var(--controls-top);
  font-size: var(--font-size-spinner-text);
  color: var(--text-secondary);
  display: inline-block;
  z-index: calc(var(--z-collapse-btn) + 1);
  transition: opacity var(--transition-expand),
    transform var(--transition-expand);
  opacity: 0;
  transform: translateY(var(--anim-offset-y)) scale(var(--anim-scale));
}

.controls.collapsed .spinner,
.controls.collapsed .spinnerText {
  opacity: var(--opacity-collapsed);
  transform: translateY(var(--transform-collapse-y));
  transition: opacity var(--transition-collapse),
    transform var(--transition-collapse);
}

/* visible class for spinner and spinner text */
.spinner.visible,
.spinnerText.visible {
  opacity: 1;
  transform: translateY(0) scale(1);
  transition: opacity var(--transition-expand),
    transform var(--transition-expand);
}

@keyframes spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

/* Styles moved from inline attributes in index.html */
#titleText {
  font-size: var(--font-size-title);
  font-weight: var(--font-weight-strong);
  margin-bottom: var(--gap-medium);
  text-align: center;
  color: var(--text-light);
  transition: margin-bottom var(--transition-expand);
  position: relative;
}
#titleText::after {
  content: "";
  position: absolute;
  bottom: 0;
  right: 0;
  width: var(--title-overlay-width);
  height: var(--title-overlay-height);
  background: linear-gradient(
    to right,
    transparent,
    var(--title-overlay-color) var(--title-overlay-gradient-stop)
  );
  opacity: 0;
  transition: opacity var(--transition-expand);
  pointer-events: none;
}
.controls.collapsed #titleText {
  opacity: var(--opacity-visible);
  transform: none;
  pointer-events: auto;
  margin-bottom: 0;
  transition: margin-bottom var(--transition-collapse);
}
.controls.collapsed #titleText::after {
  opacity: 1;
  transition: opacity var(--transition-collapse);
}
.datasetRow {
  display: flex;
  align-items: center;
  gap: var(--gap-medium);
}
.datasetRow label {
  width: var(--label-width);
}
#datasetSelect,
#algoSelect,
#endpointInput {
  flex: 1;
}
#editCustom {
  opacity: 0;
  transform: translateY(calc(-1 * var(--anim-offset-y)))
    scale(var(--anim-scale));
  transition: opacity var(--transition-expand),
    transform var(--transition-expand);
  pointer-events: none;
}

/* visible helper class used by JS to animate appearance */
#editCustom.visible {
  opacity: 1;
  transform: translateY(0) scale(1);
  pointer-events: auto;
}
.algoSpacer {
  width: var(--btn-min-width);
}
.speedRow {
  display: flex;
  align-items: center;
  gap: var(--gap-medium);
  margin-top: var(--gap-medium);
}
#mstTotal {
  margin-top: var(--gap-small);
  font-weight: var(--font-weight-semibold);
  color: var(--text-secondary);
}
.controls .description {
  max-width: var(--description-max-width);
  margin-top: var(--gap-medium);
  font-size: var(--font-size-description);
  color: var(--text-tertiary);
}
#customModal {
  display: none;
  position: fixed;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background: var(--modal-bg);
  align-items: center;
  justify-content: center;
  z-index: var(--z-modal);
}

/* Export modal mirror of customModal so it's positioned and visible */
#exportModal {
  display: none;
  position: fixed;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background: var(--modal-bg);
  align-items: center;
  justify-content: center;
  z-index: var(--z-modal);
  opacity: 0;
  pointer-events: none;
  transition: opacity var(--modal-anim-ms) ease-out;
}
#exportModal.visible {
  display: flex;
  opacity: 1;
  pointer-events: auto;
}
#exportModal.visible .modalContent {
  transform: translateY(0) scale(1);
  opacity: 1;
}
.modalContent {
  will-change: transform, opacity;
}
/* Animated visibility for modal */
#customModal {
  opacity: 0;
  pointer-events: none;
  transition: opacity var(--modal-anim-ms) ease-out;
}
#customModal.visible {
  display: flex;
  opacity: 1;
  pointer-events: auto;
}
.modalContent {
  transform: translateY(var(--anim-offset-y)) scale(var(--anim-scale));
  opacity: 0;
  transition: transform var(--modal-anim-ms) ease-out,
    opacity var(--modal-anim-ms) ease-out;
}
#customModal.visible .modalContent {
  transform: translateY(0) scale(1);
  opacity: 1;
}
.modalContent {
  background: linear-gradient(
    180deg,
    var(--modal-content-bg-start),
    var(--modal-content-bg-end)
  );
  padding: var(--modal-content-padding);
  border-radius: var(--controls-border-radius);
  max-width: var(--modal-content-max-width);
  width: calc(100% - var(--controls-modal-margin));
  margin: var(--controls-modal-margin) auto;
  position: relative;
  box-sizing: border-box;
}
.modalHeader {
  display: flex;
  align-items: center;
  gap: var(--gap-medium);
  margin-bottom: var(--gap-medium);
}
.modalButtons {
  display: flex;
  gap: var(--gap-small);
  align-items: center;
}
.themeIcon {
  display: inline-block;
  transition: transform var(--transition-theme-icon),
    opacity var(--transition-theme-icon);
  will-change: transform, opacity;
  opacity: var(--opacity-visible);
}
.themeIcon.fade-out {
  transform: rotate(var(--transform-icon-rotate))
    scale(var(--transform-icon-scale));
  opacity: var(--opacity-collapsed);
}
.themeIcon.fade-in {
  transform: rotate(0deg) scale(1);
  opacity: var(--opacity-visible);
}

/* Collapse toggle button */
.collapseToggle {
  position: absolute;
  bottom: var(--collapse-btn-bottom);
  right: var(--collapse-btn-right);
  width: var(--collapse-btn-size);
  height: var(--collapse-btn-size);
  padding: 0;
  border-radius: 50%;
  border: 1px solid var(--border-collapse-btn);
  background: var(--bg-overlay-medium);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--text-light);
  font-size: var(--font-size-collapse-btn);
  transition: background var(--transition-collapse-bg);
  z-index: var(--z-collapse-btn);
}
.collapseToggle:hover {
  background: var(--bg-overlay-hover);
}
.collapseToggle:active {
  background: var(--bg-overlay-active);
}
.collapseArrow {
  display: inline-block;
  transition: transform var(--transition-expand);
  will-change: transform;
}
.controls.collapsed .collapseArrow {
  transform: rotate(var(--transform-arrow-rotate));
  transition: transform var(--transition-collapse);
}

/* Collapsible content wrapper */
.controls > *:not(.collapseToggle):not(#titleText) {
  transition: opacity var(--transition-expand),
    transform var(--transition-expand);
  overflow: hidden;
}
.controls.collapsed > *:not(.collapseToggle):not(#titleText) {
  opacity: var(--opacity-collapsed);
  transform: translateY(var(--transform-collapse-y));
  pointer-events: none;
  transition: opacity var(--transition-collapse),
    transform var(--transition-collapse);
}
.customQueryArea {
  width: 100%;
  height: var(--query-area-height);
  font-family: var(--font-family, 'Fredoka', sans-serif);
  font-size: var(--font-size-query);
  text-align: left;
  background: var(--query-area-bg);
  color: var(--query-area-text);
  border: 1px solid var(--border-lighter);
  border-radius: var(--btn-border-radius);
  padding: var(--query-area-padding);
  box-sizing: border-box;
  max-width: 100%;
  resize: vertical;
}

/* Smooth color transitions for highlight markers */
.leaflet-interactive.highlight-marker {
  transition: stroke-opacity var(--transition-fade),
    fill-opacity var(--transition-fade), opacity var(--transition-fade);
}

/* Export modal specific styles */
.exportModalContent {
  min-width: 400px;
}

.exportStatus {
  margin-bottom: var(--gap-medium);
  font-size: var(--font-size-description);
  color: var(--text-secondary);
  text-align: center;
}

.exportProgressContainer {
  width: 100%;
  height: 24px;
  background: var(--query-area-bg);
  border: 1px solid var(--border-lighter);
  border-radius: var(--btn-border-radius);
  overflow: hidden;
  margin-bottom: var(--gap-medium);
}

.exportProgressBar {
  height: 100%;
  background: linear-gradient(90deg, var(--btn-ok-bg), var(--btn-ok-hover));
  width: 0%;
  transition: width 0.3s ease;
}

.exportDetails {
  font-size: var(--font-size-spinner-text);
  color: var(--text-tertiary);
  text-align: center;
  min-height: 1.5em;
}

/* Hide UI elements during export */
.exporting-gif .controls,
.exporting-gif .leaflet-control-container {
  opacity: 0 !important;
  pointer-events: none !important;
}
